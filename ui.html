<!DOCTYPE html>
<html>
<head>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: Inter, -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 12px;
      color: #333;
      background: #fff;
      padding: 16px;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .header {
      margin-bottom: 16px;
    }

    h1 {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: -0.01em;
    }

    .form-group {
      margin-bottom: 16px;
    }

    label {
      display: block;
      font-size: 11px;
      font-weight: 500;
      color: #666;
      margin-bottom: 6px;
    }

    input {
      width: 100%;
      padding: 10px 12px;
      font-size: 12px;
      border: 1px solid #e5e5e5;
      border-radius: 6px;
      background: #fafafa;
      transition: border-color 0.15s ease, background 0.15s ease;
    }

    input:focus {
      outline: none;
      border-color: #333;
      background: #fff;
    }

    .results {
      flex: 1;
      background: #fafafa;
      border: 1px solid #e5e5e5;
      border-radius: 6px;
      padding: 12px;
      overflow-y: auto;
      margin-bottom: 12px;
    }

    .results h2 {
      font-size: 11px;
      font-weight: 600;
      color: #666;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .status {
      font-size: 11px;
      color: #666;
      margin-bottom: 8px;
    }

    .status.error {
      color: #d32f2f;
    }

    .match-list {
      list-style: none;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 11px;
    }

    .match-list li {
      padding: 4px 0;
      border-bottom: 1px solid #e5e5e5;
    }

    .match-list li:last-child {
      border-bottom: none;
    }

    .actions {
      display: flex;
      gap: 8px;
    }

    button {
      flex: 1;
      padding: 10px 16px;
      font-size: 12px;
      font-weight: 500;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.15s ease;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-primary {
      background: #333;
      color: #fff;
    }

    .btn-primary:hover:not(:disabled) {
      background: #000;
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }

    .btn-secondary:hover:not(:disabled) {
      background: #e5e5e5;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Heavy Props Renamer</h1>
  </div>

  <div class="form-group">
    <label for="search">Search for prop name</label>
    <input id="search" type="text" placeholder="e.g., isActive" autofocus>
  </div>

  <div class="results">
    <h2>Results</h2>
    <p class="status" id="status">Waiting for input...</p>
    <ul class="match-list" id="match-list"></ul>
  </div>

  <div class="actions">
    <button class="btn-secondary" id="cancel">Cancel</button>
    <button class="btn-primary" id="search-btn">Search Props</button>
  </div>

  <script>
    const searchInput = document.getElementById('search');
    const searchBtn = document.getElementById('search-btn');
    const cancelBtn = document.getElementById('cancel');
    const status = document.getElementById('status');
    const matchList = document.getElementById('match-list');

    function search() {
      const query = searchInput.value.trim();

      if (!query) {
        status.textContent = 'Please enter a prop name to search.';
        status.classList.add('error');
        return;
      }

      status.textContent = 'Searching...';
      status.classList.remove('error');
      matchList.innerHTML = '';

      parent.postMessage({
        pluginMessage: {
          type: 'search-props',
          query: query.toLowerCase()
        }
      }, '*');
    }

    // Handle messages from plugin code
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;

      if (msg?.type === 'search-results') {
        status.textContent = `${msg.results.length} match(es) found.`;
        status.classList.remove('error');
        matchList.innerHTML = '';

        for (const match of msg.results) {
          const li = document.createElement('li');
          li.textContent = `${match.propName} â€” ${match.componentName}`;
          matchList.appendChild(li);
        }
      }

      if (msg?.type === 'error') {
        status.textContent = msg.message;
        status.classList.add('error');
      }
    };

    // Listen for Enter key
    searchInput.addEventListener('keydown', (event) => {
      if (event.key === 'Enter') {
        event.preventDefault();
        search();
      }
    });

    searchBtn.addEventListener('click', search);

    cancelBtn.addEventListener('click', () => {
      parent.postMessage({ pluginMessage: { type: 'close' } }, '*');
    });
  </script>
</body>
</html>
